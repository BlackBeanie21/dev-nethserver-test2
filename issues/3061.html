<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Bug #3061: OpenVPN roadwarrior doesn&#x27;t work with MultiWan configured - NethServer 6 - NethServer.org</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta content="authenticity_token" name="csrf-param" />
<meta content="xe6SsSoVbaoZlAUezNss16xDC6ajg3P6jzWUrXbVg4A=" name="csrf-token" />
<link rel='shortcut icon' href='../favicon.ico%3F1457596383' />
<link href="../stylesheets/jquery/jquery-ui-1.9.2.css%3F1403512057.css" media="all" rel="stylesheet" type="text/css" />
<link href="../themes/nethserver/stylesheets/application.css%3F1403512057.css" media="all" rel="stylesheet" type="text/css" />

<script src="../javascripts/jquery-1.8.3-ui-1.9.2-ujs-2.0.3.js%3F1403512056" type="text/javascript"></script>
<script src="../javascripts/application.js%3F1403512056" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>
<script src="../themes/nethserver/javascripts/theme.js%3F1403512057.js" type="text/javascript"></script>
<link href="../plugin_assets/openid_fix/stylesheets/openid.css%3F1403512057.css" media="screen" rel="stylesheet" type="text/css" />
<!-- page specific tags -->
    <link href="http://dev.nethserver.org/issues/3061.atom" rel="alternate" title="NethServer 6 - Bug #3061: OpenVPN roadwarrior doesn&#x27;t work with MultiWan configured" type="application/atom+xml" />
<script src="../javascripts/context_menu.js%3F1403512056" type="text/javascript"></script><link href="../stylesheets/context_menu.css%3F1403512057.css" media="screen" rel="stylesheet" type="text/css" /></head>
<body class="theme-Nethserver project-nethserver controller-issues action-show">
<div id="wrapper">
<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    
    <ul><li><a href="/index.html" class="home">Home</a></li>
<li><a href="/projects.html" class="projects">Projects</a></li></ul></div>
<div id="header">
    
<h1>NethServer 6</h1>

    <div id="main-menu">
        <ul><li><a href="/projects/nethserver" class="overview">Overview</a></li>

<li><a href="../issues.html" class="issues selected">Issues</a></li>
<li><a href="/projects/nethserver/wiki.html" class="wiki">Wiki</a></li></ul>
    </div>
</div>

<div id="main" class="">
    

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #3061</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">
    <div class="next-prev-links contextual">
      <a href="3048.html" title="#3048">« Previous</a> |
      <a href="3071.html" title="#3071">Next »</a>
    </div>

  <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d48e99853c863b497623d4e5eeb214d2?rating=PG&amp;size=50&amp;default=wavatar" ssl="false" title="" />

<div class="subject">
<div><h3>OpenVPN roadwarrior doesn&#x27;t work with MultiWan configured</h3></div>
</div>
        <p class="author">
        </p>

<table class="attributes">
<tr><th class="status">Status:</th><td class="status">CLOSED</td><th class="start-date">Start date:</th><td class="start-date"></td></tr><tr><th class="priority">Priority:</th><td class="priority">Normal</td><th class="due-date">Due date:</th><td class="due-date"></td></tr><tr><th class="assigned-to">Assignee:</th><td class="assigned-to">-</td><th class="progress">% Done:</th><td class="progress"><table class="progress progress-100" style="width: 80px;"><tr><td class="closed" style="width: 100%;"></td></tr></table><p class="percent">100%</p></td></tr><tr><th class="category">Category:</th><td class="category">nethserver-openvpn</td><th></th><td></td></tr><tr><th class="fixed-version">Target version:</th><td class="fixed-version"><a href="../versions/209.html">v6.6</a></td><th></th><td></td></tr>
<tr>
	<th class="cf_15">Security class:</th><td class="cf_15"></td>
	<th class="cf_13">Resolution:</th><td class="cf_13"></td>
</tr>
<tr>
	<th class="cf_1">Affected version:</th><td class="cf_1"><a href="../versions/201.html">v6.5</a></td>
	<th class="cf_14">NEEDINFO:</th><td class="cf_14">No</td>
</tr>


</table>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>With <code><a href="http://docs.nethserver.org/en/latest/firewall.html#multi-wan" class="external">MultiWAN</a></code> enabled, pc clients cannot connect to <code>OpenVPN roadwarrior</code> server.</p>


	<p>in <code>"/var/log/openvpn/openvpn.log"</code> you'll find:</p>


<pre>Wed Feb 25 17:43:18 2015 89.96.243.227:1194 TLS Error: TLS key negotiation failed to occur within 60 seconds (check your network connectivity)
Wed Feb 25 17:43:18 2015 89.96.243.227:1194 TLS Error: TLS handshake failed
Wed Feb 25 17:43:18 2015 89.96.243.227:1194 SIGUSR1[soft,tls-error] received, client-instance restarting</pre>

	<p>and looking at red interfaces you'll see traffic go through all nics:</p>


<pre># tcpdump  -nn -p -i eth1 port 1194
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth1, link-type EN10MB (Ethernet), capture size 65535 bytes
17:43:21.101779 IP 2.118.245.107.1194 &gt; 89.96.243.227.1194: UDP, length 26
17:43:23.378414 IP 2.118.245.107.1194 &gt; 89.96.243.227.1194: UDP, length 14
17:43:23.481847 IP 2.118.245.107.1194 &gt; 89.96.243.227.1194: UDP, length 22
17:43:27.132892 IP 2.118.245.107.1194 &gt; 89.96.243.227.1194: UDP, length 26
17:43:35.202543 IP 2.118.245.107.1194 &gt; 89.96.243.227.1194: UDP, length 14

# tcpdump  -nn -p -i eth2 port 1194
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth2, link-type EN10MB (Ethernet), capture size 65535 bytes
17:43:21.100602 IP 89.96.243.227.1194 &gt; 192.168.1.2.1194: UDP, length 14
17:43:23.481575 IP 89.96.243.227.1194 &gt; 192.168.1.2.1194: UDP, length 14
17:43:27.132638 IP 89.96.243.227.1194 &gt; 192.168.1.2.1194: UDP, length 14
17:43:35.488057 IP 89.96.243.227.1194 &gt; 192.168.1.2.1194: UDP, length 14
17:43:51.677835 IP 89.96.243.227.1194 &gt; 192.168.1.2.1194: UDP, length 14</pre>

installed packages:
	<ul>
	<li>nethserver-openvpn-1.1.2-1.ns6.noarch</li>
		<li>nethserver-vpn-1.1.4-1.ns6.noarch</li>
		<li>openvpn-2.3.1-3.el6.x86_64</li>
	</ul>
  </div>
</div>






</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset odd">
    <div class="wiki">
        <p>Client and server: fix configuration for multiwan. Refs <a href="3061.html" class="issue tracker-1 status-5 priority-4 priority-default closed" title="OpenVPN roadwarrior doesn&#x27;t work with MultiWan configured (CLOSED)">#3061</a></p>
    </div>
    </div>

</div>

<div id="history">
<h3>History</h3>
  <div id="change-14205" class="journal has-notes">
    <div id="note-1">
    <h4><a href="3061.html#note-1" class="journal-link">#1</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d48e99853c863b497623d4e5eeb214d2?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    <div class="wiki" id="journal-14205-notes"><p>Adding <strong><code>"multihome"</code></strong> directive to OpenVPN configuration file solved the issue.</p>


	<p>From <code>"openvpn"</code> man page:<br /><pre>multihome
              Configure  a  multi-homed  UDP  server.  This option can be used when OpenVPN has been configured to listen on all interfaces, and
              will attempt to bind client sessions to the interface on which packets are being received, so that outgoing packets will  be  sent
              out of the same interface.  Note that this option is only relevant for UDP servers and currently is only implemented on Linux.</pre></p></div>
    </div>
  </div>
  
  <div id="change-14206" class="journal has-details">
    <div id="note-2">
    <h4><a href="3061.html#note-2" class="journal-link">#2</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Subject</strong> changed from <i>OpenVPN roadwarrior doesn&#x27;t works with MultiWan configured</i> to <i>OpenVPN roadwarrior doesn&#x27;t work with MultiWan configured</i></li>
       <li><strong>Category</strong> set to <i>nethserver-openvpn</i></li>
       <li><strong>Status</strong> changed from <i>NEW</i> to <i>TRIAGED</i></li>
       <li><strong>Target version</strong> set to <i>v6.6</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>20</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-14224" class="journal has-details">
    <div id="note-3">
    <h4><a href="3061.html#note-3" class="journal-link">#3</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>TRIAGED</i> to <i>ON_DEV</i></li>
       <li><strong>Assignee</strong> set to <i>Giacomo Sanchietti</i></li>
       <li><strong>% Done</strong> changed from <i>20</i> to <i>30</i></li>
       <li><strong>Affected version</strong> set to <i>v6.5</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-14225" class="journal has-notes">
    <div id="note-4">
    <h4><a href="3061.html#note-4" class="journal-link">#4</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    <div class="wiki" id="journal-14225-notes"><p>Also add the <code>nobind</code> option to client configuration.</p></div>
    </div>
  </div>
  
  <div id="change-14226" class="journal has-details">
    <div id="note-5">
    <h4><a href="3061.html#note-5" class="journal-link">#5</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>ON_DEV</i> to <i>MODIFIED</i></li>
       <li><strong>% Done</strong> changed from <i>30</i> to <i>60</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-14227" class="journal has-notes has-details">
    <div id="note-6">
    <h4><a href="3061.html#note-6" class="journal-link">#6</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>MODIFIED</i> to <i>ON_QA</i></li>
       <li><strong>Assignee</strong> deleted (<del><i>Giacomo Sanchietti</i></del>)</li>
       <li><strong>% Done</strong> changed from <i>60</i> to <i>70</i></li>
    </ul>
    <div class="wiki" id="journal-14227-notes"><p>Package in nethserver-testing:<br />nethserver-openvpn-1.1.2-1.10.ge11859b.ns6.noarch.rpm</p>


<strong>Test case</strong>
	<ul>
	<li>Create a new account, download OpenvPN configuration and check the option <code>nobind</code> is present inside the configuration file</li>
		<li>Check the bug is not reproducible</li>
	</ul></div>
    </div>
  </div>
  
  <div id="change-14339" class="journal has-notes has-details">
    <div id="note-7">
    <h4><a href="3061.html#note-7" class="journal-link">#7</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d1393faf88bfcbb0b41ce36307b6a143?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>ON_QA</i> to <i>VERIFIED</i></li>
       <li><strong>% Done</strong> changed from <i>70</i> to <i>90</i></li>
    </ul>
    <div class="wiki" id="journal-14339-notes"><pre>
Updated:
  nethserver-openvpn.noarch 0:1.1.2-1.10.ge11859b.ns6                                                                               

Complete!
[root@nsrv ~]# diff host-to-net.conf /etc/openvpn/host-to-net.conf
18a19
&gt; multihome
</pre><br /><pre>
$ tail -4 filippo\ \(1\).ovpn 
persist-key
persist-tun
nobind
</pre></div>
    </div>
  </div>
  
  <div id="change-14464" class="journal has-notes has-details">
    <div id="note-8">
    <h4><a href="3061.html#note-8" class="journal-link">#8</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>VERIFIED</i> to <i>CLOSED</i></li>
       <li><strong>% Done</strong> changed from <i>90</i> to <i>100</i></li>
    </ul>
    <div class="wiki" id="journal-14464-notes">Released in nethserver-base:
	<ul>
	<li>nethserver-openvpn-1.2.0-1.ns6.noarch.rpm</li>
	</ul></div>
    </div>
  </div>
  


</div>


<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>





<script type="text/javascript">
//<![CDATA[
contextMenuInit('/issues/context_menu')
//]]>
</script>

        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Copyright &copy; 2012-2021 nethserver.org
  </div></div>
</div>
</div>
</div>

</body>
</html>
