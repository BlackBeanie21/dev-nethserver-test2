<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Feature #2492: Move admin user in LDAP DB - NethServer 6 - NethServer.org</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta content="authenticity_token" name="csrf-param" />
<meta content="xe6SsSoVbaoZlAUezNss16xDC6ajg3P6jzWUrXbVg4A=" name="csrf-token" />
<link rel='shortcut icon' href='../favicon.ico%3F1457596383' />
<link href="../stylesheets/jquery/jquery-ui-1.9.2.css%3F1403512057.css" media="all" rel="stylesheet" type="text/css" />
<link href="../themes/nethserver/stylesheets/application.css%3F1403512057.css" media="all" rel="stylesheet" type="text/css" />

<script src="../javascripts/jquery-1.8.3-ui-1.9.2-ujs-2.0.3.js%3F1403512056" type="text/javascript"></script>
<script src="../javascripts/application.js%3F1403512056" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>
<script src="../themes/nethserver/javascripts/theme.js%3F1403512057.js" type="text/javascript"></script>
<link href="../plugin_assets/openid_fix/stylesheets/openid.css%3F1403512057.css" media="screen" rel="stylesheet" type="text/css" />
<!-- page specific tags -->
    <link href="http://dev.nethserver.org/issues/2492.atom" rel="alternate" title="NethServer 6 - Feature #2492: Move admin user in LDAP DB" type="application/atom+xml" />
<script src="../javascripts/context_menu.js%3F1403512056" type="text/javascript"></script><link href="../stylesheets/context_menu.css%3F1403512057.css" media="screen" rel="stylesheet" type="text/css" /></head>
<body class="theme-Nethserver project-nethserver controller-issues action-show">
<div id="wrapper">
<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    
    <ul><li><a href="/index.html" class="home">Home</a></li>
<li><a href="/projects.html" class="projects">Projects</a></li></ul></div>
<div id="header">
    
<h1>NethServer 6</h1>

    <div id="main-menu">
        <ul><li><a href="/projects/nethserver" class="overview">Overview</a></li>

<li><a href="../issues.html" class="issues selected">Issues</a></li>
<li><a href="/projects/nethserver/wiki.html" class="wiki">Wiki</a></li></ul>
    </div>
</div>

<div id="main" class="">
    

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Feature #2492</h2>

<div class="issue tracker-2 status-5 priority-4 priority-default closed details">

  <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=50&amp;default=wavatar" ssl="false" title="" />

<div class="subject">
<div><h3>Move admin user in LDAP DB</h3></div>
</div>
        <p class="author">
        </p>

<table class="attributes">
<tr><th class="status">Status:</th><td class="status">CLOSED</td><th class="start-date">Start date:</th><td class="start-date">12/17/2013</td></tr><tr><th class="priority">Priority:</th><td class="priority">Normal</td><th class="due-date">Due date:</th><td class="due-date">12/19/2013</td></tr><tr><th class="assigned-to">Assignee:</th><td class="assigned-to">-</td><th class="progress">% Done:</th><td class="progress"><table class="progress progress-100" style="width: 80px;"><tr><td class="closed" style="width: 100%;"></td></tr></table><p class="percent">100%</p></td></tr><tr><th class="category">Category:</th><td class="category">nethserver-directory</td><th></th><td></td></tr><tr><th class="fixed-version">Target version:</th><td class="fixed-version"><a href="../versions/183.html">v6.5-beta3</a></td><th></th><td></td></tr>
<tr>
	<th class="cf_13">Resolution:</th><td class="cf_13"></td>
	<th class="cf_14">NEEDINFO:</th><td class="cf_14">No</td>
</tr>


</table>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>We must move <code>admin</code> into LDAP.</p>


Pros:
	<ul>
	<li>An administrative account is present in almost every application and can be straightforwardly mapped to <code>admin</code></li>
		<li>Better NethService 8.x / SME server backward compatibility, easier to migrate etc..</li>
	</ul>


Cons:
	<ul>
	<li><code>admin</code> is not effectively present after installation. It comes with  <a href="http://dev.nethserver.o/projects/nethserver/wiki/Nethserver-directory" class="wiki-page new">nethserver-directory</a>. </li>
		<li><code>server-manager</code> must be running with different credentials, some filesystem permissions issues must be solved</li>
		<li>To access the server-manager an alias mechanism is needed.</li>
	</ul>
  </div>
</div>
<div class="attachments">
<p><a href="../attachments/download/246/upgrade-65b3.sh" class="icon icon-attachment">upgrade-65b3.sh</a>    <a href="../attachments/246/upgrade-65b3.sh.html"><img alt="Magnifier" src="../images/magnifier.png%3F1403512056" /></a>
   - Final 6.5 beta3 upgrade script
  <span class="size">(1.13 KB)</span>
    <span class="author">Davide Principi, 02/05/2014 04:56 PM</span>
  </p>
</div>





<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form>
<table class="list issues">
  <tr class="issue hascontextmenu" id="relation-491">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2551" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="2551.html" class="issue tracker-2 status-5 priority-4 priority-default closed">Feature #2551</a>: Move httpd-admin web server logs
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date">01/02/2014</td>
  <td class="due_date">01/02/2014</td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-492">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2536" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="2536.html" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #2536</a>: Restore httpd-admin symlink
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date">01/02/2014</td>
  <td class="due_date">01/02/2014</td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-495">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2499" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="2499.html" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #2499</a>: Override mail system /etc/aliases
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date">01/03/2014</td>
  <td class="due_date">01/03/2014</td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-500">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2573" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="2573.html" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #2573</a>: Ibay contents inherit default owner
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date">01/10/2014</td>
  <td class="due_date">01/10/2014</td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-505">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2582" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="2582.html" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #2582</a>: Base: remove bootstrap-console
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date"></td>
  <td class="due_date"></td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-515">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2291" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="2291.html" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #2291</a>: NUT: add option to enable mail notification
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date"></td>
  <td class="due_date"></td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-526">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2294" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="2294.html" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #2294</a>: IPSec: honor VPNClientAccess property
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date"></td>
  <td class="due_date"></td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-528">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2647" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="2647.html" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #2647</a>: Send backup notification to root
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date"></td>
  <td class="due_date"></td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-539">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2675" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="2675.html" class="issue tracker-1 status-5 priority-4 priority-default closed">Bug #2675</a>: Backup Notification to System administrator fails by default
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date"></td>
  <td class="due_date"></td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-553">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2733" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="2733.html" class="issue tracker-1 status-5 priority-4 priority-default closed">Bug #2733</a>: Domain Administrators rights not enforced by workstations
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date"></td>
  <td class="due_date"></td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-678">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="3026" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="3026.html" class="issue tracker-2 status-5 priority-4 priority-default closed">Feature #3026</a>: Differentiate root and admin users
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date"></td>
  <td class="due_date"></td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-510">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="1911" /></td>
  <td class="subject">
    Duplicated by
    
    NethServer 6 - 
    <a href="1911.html" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #1911</a>: Ejabberd: create jabberadmins user on nethserver-ejabberd...
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date"></td>
  <td class="due_date"></td>
  <td class="buttons"></td>
  </tr>
</table>
</form>

<form accept-charset="UTF-8" action="http://dev.nethserver.org/issues/2492/relations" class="new_relation" data-remote="true" id="new-relation-form" method="post" style="display: none;"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="xe6SsSoVbaoZlAUezNss16xDC6ajg3P6jzWUrXbVg4A=" /></div>


<p><select id="relation_relation_type" name="relation[relation_type]" onchange="setPredecessorFieldsVisibility();"><option value="relates" selected="selected">Related to</option>
<option value="duplicates">Duplicates</option>
<option value="duplicated">Duplicated by</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input id="relation_issue_to_id" name="relation[issue_to_id]" size="10" type="text" />
<span id="predecessor_fields" style="display:none;">
Delay: <input id="relation_delay" name="relation[delay]" size="3" type="text" /> days
</span>
<input name="commit" type="submit" value="Add" />
<a href="2492.html#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script type="text/javascript">
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?project_id=nethserver&scope=all')
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset odd">
    <div class="wiki">
        <p>Run httpd-admin and smwingsd in "adm" group. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>httpd-admin is run as srvmgr system user, which is member of the "adm" <br />group.</p>


	<p>Any user in "adm" group will be granted unlimited access to "db",<br />"config" and other administrative commands.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Moved /etc/sudoers template fragment to nethserver-base. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Fix permissions on *-update event. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>Cleanup and fix permissions on files under<br />/var/cache/nethserver-httpd-admin/ directory.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Group ownership controlled by setgid bit. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>Removed chown() calls from esmith DB libraries. Don't touch file<br />permissions, use defaults from filesystem: write access to root only,<br />read access to "adm" group members.</p>


	<p>DB files are created through sudo calls and inherit default root umask<br />0022.</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Fallback to root login if "admin" account is not available. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>If admin passwd entry is missing, check "root" login password.</p>


	<p>This hack gives the impression that admin user is available even if<br />nethserver-directory is not installed.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Fix admin's mailbox migration. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>The admin user is now in accounts DB.</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Imported libuser setup from nethserver-base. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>esmith::util (setUnixSystemPassword): check if admin account exists. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>Also, honour AdminIsNotRoot key value (Refs <a href="2277.html" class="issue tracker-6 status-5 priority-4 priority-default closed" title="Base: add AdminIsNotRoot to keep admin and root password in sync (CLOSED)">#2277</a>).</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>admin account is now in LDAP. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>It does not need special treatment anymore.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Import mail from root mailbox to admin. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Deliver root's mail to admin. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a> <a href="2499.html" class="issue tracker-6 status-5 priority-4 priority-default closed" title="Override mail system /etc/aliases (CLOSED)">#2499</a></p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Initialize admin account in LDAP. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>If admin account already exists, preserve its password and uid number,<br />otherwise root password is imported.</p>


	<p>The nsstest account is created with uid >= 501, to leave id 500 free<br />for admin.</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>nethserver-directory-user-modify: skip lusermod command if cn is empty. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Group/User UI modules: honour Removable prop. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>The platform validator was not invoked in delete case, because the key<br />parameter is not submitted, but derived from the request URL path.</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Additional sudo commands for adm group. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Migrate admin home directory. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a> <a href="1655.html" class="issue tracker-6 status-5 priority-4 priority-default closed child" title="Users and groups migration script (CLOSED)">#1655</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Removed special case for admin. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>Admin is record is of type user.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Change group memberUid attribute in LDAP directly. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>Don't use libuser lgroupmod binary to manipulate group members. It<br />fails silently for empty members list.</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Removed "shared" group. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>Use builtin "locals" group, managed by nethserver-directory.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>admin is default member of domadmins group. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Create the default faxmaster group through create-default-accounts action. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>"shared" group replaced by "locals". Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Create the predefined "locals" group. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>The "locals" group always contains users defined into the local accounts database.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Check if group exists before signalling group-modify event. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Initialize ibays from default DB records at the end of yum transaction. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>We temporarily rely on "runlevel-adjust" event, but a more specifc<br />event should be defined.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Initialize admin and other default accounts after all *-update events. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Initialize admin and create default accounts at the end of yum transaction. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>We temporarily rely on "runlevel-adjust" event, but a more specifc<br />event should be defined.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>nethserver-mail-update-admin action: signal user-modify admin event. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>This action comes into play when mail-server is installed after<br />nethserver-directory: the admin account exists and needs to be<br />updated. It checks the LDAP accountStatus attribute.</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Set local mail address if none is defined. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>The "mail" LDAP attribute is used by SOGo to set up user account: the<br />blank value was not accepted.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>admin system user no longer created by RPM %pre script. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Imported /etc/sudoers template fragments from nethserver-httpd-admin. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>The NETHSERVER_ADM command alias defines the list of administrative<br />commands that can be run by the "adm" group members.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Grant unlimited access to root and admin on server-manager modules. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>Members of the adm group have also unlimited access.</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>UserProfile UI module: access to root key in configuration DB. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>If the admin user is not defined in accounts DB, fall back to root<br />profile record in configuration DB.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>nethserver-base-mail-aliases action. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>The admin alias has been removed. Now mail is stored to local root<br />mailbox.</p>


	<p>Forward messages for root to an external mail address. Keep a local<br />copy, if requested.</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Moved libuser setup to nethserver-directory. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>libuser commands are not used by nethserver-base.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Added bash aliases for adm group commands executed by sudo. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Change ownership of session files from numerical uid. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>This covers the scenario where the admin user passwd entry has been<br />removed manually.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Fixed default local mail address setting. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>Removed nethserver-mail-ldap-sync: to update all "mail" attributes in<br />LDAP when a domain record changes, use the<br />nethserver-mail-account-update action.</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Map "shared" group to "locals" during ibay migration. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>SharedFolder UI module: "Authenticated users" label renamed "Local users". Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>The "authenticated" term can be misleading with Samba ADS role, for instance.</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Update admin user, adding samba attributes. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>The samba SAM attributes are initialized by<br />nethserver-samba-user-create action.</p>


	<p>Added default domadmins group description.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Migration: replace "shared" group with "locals" when restoring Posix ACLs. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Initialize admin's mailbox after account has been set up. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>Fixed default MailForwardKeepMessageCopy prop name.</p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Synchronize admin/root passwords. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>


	<p>If AdminIsNotRoot is disabled, admin and root passwords are the same.</p>


	<p>Refactored the bash script, removing reduntant nested IFs.</p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>templates, nethserver-openvpn-genclient: use srvmgr user and adm group. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>spec, pki-vpn-gencert, pki-vpn-renew: use srvmgr user and adm group. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <div class="wiki">
        <p>Send UPS/nut messages to root account. Refs <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>
    <div class="changeset even">
    <div class="wiki">
        <p>Create l2tpusers after admin account initialization. Refs <a href="2294.html" class="issue tracker-6 status-5 priority-4 priority-default closed" title="IPSec: honor VPNClientAccess property (CLOSED)">#2294</a> <a href="2492.html" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Move admin user in LDAP DB (CLOSED)">#2492</a></p>
    </div>
    </div>

</div>

<div id="history">
<h3>History</h3>
  <div id="change-9328" class="journal has-details">
    <div id="note-1">
    <h4><a href="2492.html#note-1" class="journal-link">#1</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Due date</strong> set to <i>12/19/2013</i></li>
       <li><strong>Status</strong> changed from <i>TRIAGED</i> to <i>ON_DEV</i></li>
       <li><strong>Assignee</strong> set to <i>Davide Principi</i></li>
       <li><strong>Start date</strong> set to <i>12/17/2013</i></li>
       <li><strong>% Done</strong> changed from <i>20</i> to <i>30</i></li>
       <li><strong>Estimated time</strong> set to <i>16.00</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-9629" class="journal has-notes">
    <div id="note-2">
    <h4><a href="2492.html#note-2" class="journal-link">#2</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    <div class="wiki" id="journal-9629-notes"><p><strong>Test case notes</strong></p>


	<ol>
	<li>Migration of admin's home directory both in empty and non-empty cases.</li>
		<li>Group membership workflow: create/modify/delete with a member list of any length</li>
		<li>Email delivery to root. root mailbox moved to <code>admin</code> when installed <a href="http://dev.nethserver.o/projects/nethserver/wiki/Nethserver-mail-server" class="wiki-page new">nethserver-mail-server</a>. Email delivery to <code>admin</code>.</li>
		<li>Check domain join when PDC (<a href="http://dev.nethserver.o/projects/nethserver/wiki/Nethserver-samba" class="wiki-page new">nethserver-samba</a>). <code>admin</code> samba user should have granted <code>SeMachineAccountPrivilege</code>, that allow managing domain computer accounts.</li>
		<li><code>admin</code> user is default member of <code>jabberadmins</code> group <a href="http://dev.nethserver.o/projects/nethserver/wiki/Nethserver-ejabberd" class="wiki-page new">nethserver-ejabberd</a> </li>
		<li><code>admin</code> user is default member of <code>faxmaster</code> group <a href="http://dev.nethserver.o/projects/nethserver/wiki/Nethserver-hylafax" class="wiki-page new">nethserver-hylafax</a> </li>
		<li>IMAP <code>admin</code> login, SOGo <code>admin</code> login</li>
		<li>server manager allows logging in as admin, even if <code>nethserver-directory</code> is not installed, providing the root's password. <code>AdminIsNotRoot</code> key must be honoured.</li>
	</ol>


	<p><strong>Release notes</strong></p>


	<p>When this issue is CLOSED, add the following release notes</p>


	<a name="nethserver-base"></a>
<h3 ><a href="http://dev.nethserver.o/projects/nethserver/wiki/Nethserver-base" class="wiki-page new">nethserver-base</a><a href="2492.html#nethserver-base" class="wiki-anchor">&para;</a></h3>


	<p>Before upgrade:</p>


	<ol>
	<li>Stop <code>httpd-admin</code> (if still running as <code>admin</code>) then remove the <code>admin</code> account, if it's present in <code>passwd</code>:<pre>
    # service httpd-admin stop; killall httpd-admin; stop httpd-admin
    # grep -q admin /etc/passwd &#38;&#38; userdel admin
</pre></li>
		<li>Fix DB permissions:<pre>
    # chown -v root:adm /var/lib/nethserver/db/*
</pre></li>
		<li>Move <code>admin</code> key in <code>configuration</code> DB to <code>root</code>:<pre>
    # sed -i 's/^admin=/root=/' /var/lib/nethserver/db/configuration
</pre></li>
		<li>Clean up <code>/etc/aliases</code>:<pre>
    # sed -r -i '/^(# NethServer|root:|admin:)/ d' /etc/aliases
</pre></li>
	</ol>


	<a name="nethserver-directory"></a>
<h3 ><a href="http://dev.nethserver.o/projects/nethserver/wiki/Nethserver-directory" class="wiki-page new">nethserver-directory</a><a href="2492.html#nethserver-directory" class="wiki-anchor">&para;</a></h3>


	<p>After upgrade:</p>


	<ol>
	<li>Refresh group members:<pre>
    # /etc/e-smith/events/actions/group-modify-unix ev
</pre></li>
		<li>Initialize <code>locals</code> group:<pre>
    # local_users=(`grep -F '=user|' /var/lib/nethserver/db/accounts | cut -d = -f 1`); lgroupmod -M "`echo ${local_users[*]} | tr ' ' ','`" locals
</pre></li>
	</ol>


	<a name="nethserver-ibays"></a>
<h3 ><a href="http://dev.nethserver.o/projects/nethserver/wiki/Nethserver-ibays" class="wiki-page new">nethserver-ibays</a><a href="2492.html#nethserver-ibays" class="wiki-anchor">&para;</a></h3>


	<ul>
	<li>Before upgrade, remove <code>shared</code> group:<pre>
    # luserdel shared
</pre></li>
		<li>After upgrade change ownership to <code>locals</code>:<pre>
    # for IBAY in `grep -F '|OwningGroup|shared' /var/lib/nethserver/db/accounts  | cut -d = -f 1`; do db accounts setprop $IBAY OwningGroup locals; chgrp -Rv locals /var/lib/nethserver/ibay/$IBAY; done
</pre></li>
	</ul>


	<a name="nethserver-openvpn"></a>
<h3 ><a href="http://dev.nethserver.o/projects/nethserver/wiki/Nethserver-openvpn" class="wiki-page new">nethserver-openvpn</a><a href="2492.html#nethserver-openvpn" class="wiki-anchor">&para;</a></h3>


	<ul>
	<li>After upgrade change ownership of configuration files:<br /><pre>
# find /var/lib/nethserver/certs/ -group admin -exec chgrp adm '{}' \;
# find /etc/openvpn/ -group admin -exec chgrp adm '{}' \;
# find /var/lib/nethserver/certs/ -user admin -exec chown srvmgr '{}' \;
# find /etc/openvpn/ -user admin -exec chown srvmgr '{}' \;
</pre></li>
	</ul></div>
    </div>
  </div>
  
  <div id="change-9810" class="journal has-details">
    <div id="note-3">
    <h4><a href="2492.html#note-3" class="journal-link">#3</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>ON_DEV</i> to <i>MODIFIED</i></li>
       <li><strong>Assignee</strong> deleted (<del><i>Davide Principi</i></del>)</li>
       <li><strong>% Done</strong> changed from <i>30</i> to <i>60</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-9812" class="journal has-notes has-details">
    <div id="note-4">
    <h4><a href="2492.html#note-4" class="journal-link">#4</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>MODIFIED</i> to <i>ON_QA</i></li>
       <li><strong>% Done</strong> changed from <i>60</i> to <i>70</i></li>
    </ul>
    <div class="wiki" id="journal-9812-notes"><p>In nethserver-testing:<br />nethserver-lib-1.4.0-3.0gitce8e11f1.ns6.noarch.rpm<br />nethserver-base-1.5.0-11.0git12b07501.ns6.noarch.rpm<br />nethserver-directory-1.3.0-12.0git01b2300a.ns6.noarch.rpm<br />nethserver-nethgui-1.3.0-5.0gitb985d576.ns6.noarch.rpm<br /><del>nethserver-mail-server-1.5.0-8.0git7757599e.ns6.noarch.rpm</del><br />nethserver-mail-server-1.5.0-9.0git7a2ea1cd.ns6.noarch.rpm<br />nethserver-samba-1.4.0-3.0git4fc31495.ns6.noarch.rpm<br />nethserver-ejabberd-1.0.2-3.0git6fec4e8d.ns6.noarch.rpm<br />nethserver-hylafax-1.0.3-2.0git1b8d9075.ns6.noarch.rpm<br />nethserver-httpd-admin-1.1.0-10.0gitbc7bb28c.ns6.noarch.rpm<br /><del>nethserver-ibays-2.0.1-3.0git0be47b0b.ns6.noarch.rpm</del><br /><del>nethserver-ibays-2.0.1-6.0git6a7d6544.ns6.noarch.rpm</del><br />nethserver-ibays-2.0.1-7.0git1d01b49f.ns6.noarch.rpm</p></div>
    </div>
  </div>
  
  <div id="change-9837" class="journal has-details">
    <div id="note-5">
    <h4><a href="2492.html#note-5" class="journal-link">#5</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Assignee</strong> set to <i>Giacomo Sanchietti</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-9856" class="journal has-notes">
    <div id="note-6">
    <h4><a href="2492.html#note-6" class="journal-link">#6</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    <div class="wiki" id="journal-9856-notes"><a name="Testing-upgraded-machine"></a>
<h3 >Testing upgraded machine<a href="2492.html#Testing-upgraded-machine" class="wiki-anchor">&para;</a></h3>


	<p><strong>Test case 1</strong><br />Home directory correctly created: /var/lib/nethserver/home/admin <br /><strong>Note:</strong>  migration from NethService/SME not testd</p>


	<p><strong>Test case 2</strong><br />The admin users is in LDAP, users and groups are correctly created:<br /><pre>
root@test yum.repos.d]# ldapsearch -Y EXTERNAL uid=admin
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
# extended LDIF
#
# LDAPv3
# base &lt;dc=directory,dc=nh&gt; (default) with scope subtree
# filter: uid=admin
# requesting: ALL
#

# admin, People, directory.nh
dn: uid=admin,ou=People,dc=directory,dc=nh
uid: admin
shadowMin: 0
shadowWarning: 7
shadowExpire: -1
shadowInactive: -1
gecos: admin
shadowLastChange: 16085
shadowFlag: -1
uidNumber: 500
gidNumber: 500
homeDirectory: /var/lib/nethserver/home/admin
loginShell: /bin/bash
objectClass: posixAccount
objectClass: shadowAccount
objectClass: inetOrgPerson
telephoneNumber: 555-5555
o: XYZ Corporation
ou: Main
l: Ottawa
street: 123 Main Street
cn: System Administrator
givenName: System
sn: Administrator
shadowMax: 180
userPassword:: e0NSWVBUfSQ2JHhqVE5tVEtZJEY2S29RejBrQ3JHdzVIYUtlUS5QYlY1NnUxS2F
 NakRvaUhBZXJ4ckJOMWM3NFo1bzZqSWYuYi5ZZ0VvTUQ1Si40N3phckdQVnVGalcvaWNKREhMamEv

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1

[root@test ~]# ldapsearch -Y EXTERNAL cn=test
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
# extended LDIF
#
# LDAPv3
# base &lt;dc=directory,dc=nh&gt; (default) with scope subtree
# filter: cn=test
# requesting: ALL
#

# test, Groups, directory.nh
dn: cn=test,ou=Groups,dc=directory,dc=nh
cn: test
gidNumber: 5001
objectClass: posixGroup
memberUid: giacomo

# test, People, directory.nh
dn: uid=test,ou=People,dc=directory,dc=nh
uid: test
shadowMin: 0
shadowMax: 99999
shadowWarning: 7
shadowExpire: -1
homeDirectory: /home/test
shadowInactive: -1
userPassword:: e0NSWVBUfSEh
shadowLastChange: 16085
shadowFlag: -1
uidNumber: 5001
gidNumber: 5001
loginShell: /bin/false
sn: test
objectClass: posixAccount
objectClass: shadowAccount
objectClass: inetOrgPerson
cn: test
gecos: aa

# search result
search: 2
result: 0 Success

# numResponses: 3
# numEntries: 2
</pre></p>


	<p><strong>Test case 3</strong><br />Mails are correctly delivered to admin user:<br /><pre>
Jan 15 16:11:42 test dovecot: lmtp(30158): Connect from local
Jan 15 16:11:43 test dovecot: lmtp(30158, admin): UtJcOC6l1lLOdQAA6nEqjg: sieve: msgid=&lt;20140115151142.D2136346E@test.test.loc&gt;: stored mail into mailbox 'INBOX'
Jan 15 16:11:43 test postfix/lmtp[30157]: D2136346E: to=&lt;admin@test.test.loc&gt;, orig_to=&lt;root@test.test.loc&gt;, relay=test.test.loc[/var/run/dovecot/lmtp], delay=0.14, delays=0/0.04/0.04/0.06, dsn=2.0.0, status=sent (250 2.0.0 &lt;admin@test.test.loc&gt; UtJcOC6l1lLOdQAA6nEqjg Saved)
Jan 15 16:11:43 test dovecot: lmtp(30158): Disconnect from local: Client quit (in reset)
Jan 15 16:11:43 test postfix/qmgr[27420]: D2136346E: removed
Jan 15 16:12:22 test postfix/pickup[27419]: DEFE9346F: uid=0 from=&lt;root&gt;
Jan 15 16:12:22 test postfix/cleanup[30151]: DEFE9346F: message-id=&lt;20140115151222.DEFE9346F@test.test.loc&gt;
Jan 15 16:12:22 test postfix/qmgr[27420]: DEFE9346F: from=&lt;root@test.test.loc&gt;, size=420, nrcpt=1 (queue active)
Jan 15 16:12:22 test dovecot: lmtp(30158): Connect from local
Jan 15 16:12:22 test dovecot: lmtp(30158, admin): VtJcOC6l1lLOdQAA6nEqjg: sieve: msgid=&lt;20140115151222.DEFE9346F@test.test.loc&gt;: stored mail into mailbox 'INBOX'
Jan 15 16:12:22 test dovecot: lmtp(30158): Disconnect from local: Client quit (in reset)
Jan 15 16:12:22 test postfix/lmtp[30157]: DEFE9346F: to=&lt;admin@test.test.loc&gt;, orig_to=&lt;admin&gt;, relay=test.test.loc[/var/run/dovecot/lmtp], delay=0.06, delays=0.05/0/0/0.01, dsn=2.0.0, status=sent (250 2.0.0 &lt;admin@test.test.loc&gt; VtJcOC6l1lLOdQAA6nEqjg Saved)
Jan 15 16:12:22 test postfix/qmgr[27420]: DEFE9346F: removed
Jan 15 16:12:39 test dovecot: master: Warning: Killed with signal 15 (by pid=31959 uid=0 code=kill)
Jan 15 16:12:40 test dovecot: master: Dovecot v2.1.16 starting up (core dumps disabled)
Jan 15 16:12:49 test postfix/pickup[27419]: C1FCE3471: uid=0 from=&lt;root&gt;
Jan 15 16:12:49 test postfix/cleanup[30151]: C1FCE3471: message-id=&lt;20140115151249.C1FCE3471@test.test.loc&gt;
Jan 15 16:12:49 test postfix/qmgr[27420]: C1FCE3471: from=&lt;root@test.test.loc&gt;, size=419, nrcpt=1 (queue active)
Jan 15 16:12:49 test dovecot: lmtp(32163): Connect from local
Jan 15 16:12:49 test postfix/lmtp[30157]: C1FCE3471: to=&lt;admin@test.test.loc&gt;, orig_to=&lt;root&gt;, relay=test.test.loc[/var/run/dovecot/lmtp], delay=0.15, delays=0.1/0/0.01/0.04, dsn=2.0.0, status=sent (250 2.0.0 &lt;admin@test.test.loc&gt; S3F6MHGl1lKjfQAA6nEqjg Saved)
Jan 15 16:12:49 test dovecot: lmtp(32163, admin): S3F6MHGl1lKjfQAA6nEqjg: sieve: msgid=&lt;20140115151249.C1FCE3471@test.test.loc&gt;: stored mail into mailbox 'INBOX'
Jan 15 16:12:49 test dovecot: lmtp(32163): Disconnect from local: Client quit (in reset)
Jan 15 16:12:49 test postfix/qmgr[27420]: C1FCE3471: removed
</pre></p>


	<p><strong>Test case 4</strong><br />Tested with WindowsXP client, it works.<br /><strong>Note</strong>: Samba access for admin user must be explicitly set, also admin user password must be set.</p>


	<p><strong>Test case 5 and 6</strong><br /><pre>
[root@test yum.repos.d]# getent group faxmaster
faxmaster:*:504:admin
[root@test yum.repos.d]# getent group jabberadmins
jabberadmins:*:503:admin
[root@test yum.repos.d]# getent group locals
locals:*:502:admin
</pre></p>


	<p><strong>Test case 7</strong><br />The <code>admin</code> user can access SOGo and IMAP.<br /><strong>NOTE</strong>: on SOGo UI, the label for mail root directory is "0" instead of admin@domain (on the left of the screen). This is caused by the blank <code>mail</code> field inside LDAP user.</p>


	<p><strong>Test case 8</strong><br />Access to WEB UI is always granted to root and admin users. <code>AdminIsNotRoot</code> is honored.</p></div>
    </div>
  </div>
  
  <div id="change-9868" class="journal has-notes">
    <div id="note-7">
    <h4><a href="2492.html#note-7" class="journal-link">#7</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    <div class="wiki" id="journal-9868-notes"><p>Giacomo Sanchietti wrote:</p>


<blockquote>

	<p><strong>Test case 7</strong><br />The <code>admin</code> user can access SOGo and IMAP.<br /><strong>NOTE</strong>: on SOGo UI, the label for mail root directory is "0" instead of admin@domain (on the left of the screen). This is caused by the blank <code>mail</code> field inside LDAP</p>


</blockquote>

	<p>Fixed.</p>


	<p>In nethserver-testing:<br />nethserver-mail-server-1.5.0-9.0git7a2ea1cd.ns6.noarch.rpm</p>


	<p>Marking this note as VERIFIED - Giacomo</p></div>
    </div>
  </div>
  
  <div id="change-9878" class="journal has-notes">
    <div id="note-8">
    <h4><a href="2492.html#note-8" class="journal-link">#8</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    <div class="wiki" id="journal-9878-notes"><a name="Testing-freshly-installed-machine"></a>
<h3 >Testing freshly installed machine<a href="2492.html#Testing-freshly-installed-machine" class="wiki-anchor">&para;</a></h3>


	<p><strong>Test case 1</strong><br />Home directory correctly created: /var/lib/nethserver/home/admin <br />Also tested migration from NethService/SME.</p>


	<p><strong>Test case 2</strong><br />Group create/modify/delete OK.</p>


	<p><strong>Test case 3</strong><br />Mail is not moved from root to admin user.<br /><pre>
[root@localhost ~]# cat /var/spool/mail/root 
From root@localhost.localdomain  Wed Jan 15 18:25:33 2014
Return-Path: &lt;root@localhost.localdomain&gt;
X-Original-To: root
Delivered-To: root@localhost.localdomain
Received: by localhost.localdomain (Postfix, from userid 0)
    id 574ED3F43E; Wed, 15 Jan 2014 18:25:33 +0100 (CET)
Date: Wed, 15 Jan 2014 18:25:33 +0100
To: root@localhost.localdomain
Subject: hi
User-Agent: Heirloom mailx 12.4 7/29/08
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-Id: &lt;20140115172533.574ED3F43E@localhost.localdomain&gt;
From: root@localhost.localdomain (root)

hi

[root@localhost ~]# cat /var/spool/mail/admin 
</pre></p>


	<p><strong>FAILED</strong></p>


	<p><strong>Test case 4</strong><br />Tested with WindowsXP client, it works.<br /><strong>Note</strong>: Samba access for admin user must be explicitly set, also admin user password must be set.</p>


	<p><strong>Test case 5 and 6</strong><br />Groups are correct:<br /><pre>
[root@localhost ~]# getent group faxmaster
faxmaster:*:503:admin
[root@localhost ~]# getent group jabberadmins
jabberadmins:*:504:admin
[root@localhost ~]# getent group locals
locals:*:502:admin,u1

[root@localhost ~]# ldapsearch -Y EXTERNAL uid=admin
SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
# extended LDIF
#
# LDAPv3
# base &lt;dc=directory,dc=nh&gt; (default) with scope subtree
# filter: uid=admin
# requesting: ALL
#

# admin, People, directory.nh
dn: uid=admin,ou=People,dc=directory,dc=nh
uid: admin
shadowMin: 0
shadowWarning: 7
shadowExpire: -1
shadowInactive: -1
gecos: admin
shadowLastChange: 16085
shadowFlag: -1
uidNumber: 500
gidNumber: 500
homeDirectory: /var/lib/nethserver/home/admin
loginShell: /bin/bash
objectClass: posixAccount
objectClass: shadowAccount
objectClass: inetOrgPerson
objectClass: qmailUser
telephoneNumber: 555-5555
o: XYZ Corporation
ou: Main
l: Ottawa
street: 123 Main Street
cn: System Administrator
givenName: System
sn: Administrator
mail: admin@localhost.localdomain
accountStatus: active
shadowMax: 180
userPassword:: e0NSWVBUfSQ2JGZZSGVjSUFOYy5QRW9WaE0kbzUyTjI0d0NqTTFXQUlJTGxVUlJ
 VcXJVUmlkL01GbnAvN0tIcVJOSmhjdGpPVDZSd2hRMEt3dmJkU3FZLlA0Z0RRdUcuUFUxWWFHNW1W
 UGtIL296WDA=

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1
</pre></p>


	<p><strong>Test case 7</strong><br />Admin user can access SOGo and IMAP server. See also previous note.</p>


	<p><strong>Test case 8</strong><br />Access to WEB UI is always granted to root and admin users. AdminIsNotRoot is honored.<br /><strong>NOTE</strong>: AdminIsNotRoot is honored only with this flow admin -> root</p></div>
    </div>
  </div>
  
  <div id="change-9888" class="journal has-notes has-details">
    <div id="note-9">
    <h4><a href="2492.html#note-9" class="journal-link">#9</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>ON_QA</i> to <i>TRIAGED</i></li>
       <li><strong>Assignee</strong> deleted (<del><i>Giacomo Sanchietti</i></del>)</li>
       <li><strong>% Done</strong> changed from <i>70</i> to <i>20</i></li>
    </ul>
    <div class="wiki" id="journal-9888-notes">Some other notes:
	<ul>
	<li>the admin user is not automatically enabled to Samba service</li>
		<li>the domadmins group lacks of a description</li>
		<li>when changing the root password from web UI, the admin password is not changed</li>
	</ul>


	<p>Marking as <strong>NOT</strong> verified for the error on test case 3 in the previous note.</p></div>
    </div>
  </div>
  
  <div id="change-9892" class="journal has-details">
    <div id="note-10">
    <h4><a href="2492.html#note-10" class="journal-link">#10</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>TRIAGED</i> to <i>ON_DEV</i></li>
       <li><strong>Assignee</strong> set to <i>Davide Principi</i></li>
       <li><strong>% Done</strong> changed from <i>20</i> to <i>30</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-9909" class="journal has-details">
    <div id="note-11">
    <h4><a href="2492.html#note-11" class="journal-link">#11</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>ON_DEV</i> to <i>MODIFIED</i></li>
       <li><strong>Assignee</strong> deleted (<del><i>Davide Principi</i></del>)</li>
       <li><strong>% Done</strong> changed from <i>30</i> to <i>60</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-9910" class="journal has-notes has-details">
    <div id="note-12">
    <h4><a href="2492.html#note-12" class="journal-link">#12</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>MODIFIED</i> to <i>ON_QA</i></li>
       <li><strong>% Done</strong> changed from <i>60</i> to <i>70</i></li>
    </ul>
    <div class="wiki" id="journal-9910-notes"><p>In nethserver-testing:<br />nethserver-samba-1.4.0-6.0git92de0359.ns6.noarch.rpm<br />nethserver-base-1.5.0-13.0gitd29d5315.ns6.noarch.rpm<br />nethserver-mail-server-1.5.0-10.0gitbb33a9cc.ns6.noarch.rpm<br />nethserver-ibays-2.0.1-7.0git1d01b49f.ns6.noarch.rpm</p></div>
    </div>
  </div>
  
  <div id="change-9912" class="journal has-notes has-details">
    <div id="note-13">
    <h4><a href="2492.html#note-13" class="journal-link">#13</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>File</strong> <i>run2492.sh</i> added</li>
    </ul>
    <div class="wiki" id="journal-9912-notes"><p>The <del>attachment:run2492.sh</del> <a href="../attachments/download/246/upgrade-65b3.sh" class="attachment">upgrade-65b3.sh</a> shellscript executes the upgrade checking user and package existence.</p>


	<p>You can run it on a remote machine:<pre>
    # ssh root@davidep3 'bash -s' &lt; upgrade-65b3.sh
</pre></p>


	<p><del>Note: add a <code>sleep</code> after line 10, to be sure <code>httpd-admin</code> is stopped. Otherwise userdel may fail.</del></p></div>
    </div>
  </div>
  
  <div id="change-9933" class="journal has-notes has-details">
    <div id="note-14">
    <h4><a href="2492.html#note-14" class="journal-link">#14</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>ON_QA</i> to <i>VERIFIED</i></li>
       <li><strong>Assignee</strong> set to <i>Giacomo Sanchietti</i></li>
       <li><strong>% Done</strong> changed from <i>70</i> to <i>90</i></li>
    </ul>
    <div class="wiki" id="journal-9933-notes"><p><strong>Test case 3</strong></p>


	<p>Before nethserver-mail-server install:<br /><pre>
[root@localhost ~]# cat /var/spool/mail/root 
From root@localhost.localdomain  Thu Jan 16 10:55:46 2014
Return-Path: &lt;root@localhost.localdomain&gt;
X-Original-To: root
Delivered-To: root@localhost.localdomain
Received: by localhost.localdomain (Postfix, from userid 0)
    id 5386640AC7; Thu, 16 Jan 2014 10:55:46 +0100 (CET)
Date: Thu, 16 Jan 2014 10:55:46 +0100
To: root@localhost.localdomain
Subject: test1
User-Agent: Heirloom mailx 12.4 7/29/08
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-Id: &lt;20140116095546.5386640AC7@localhost.localdomain&gt;
From: root@localhost.localdomain (root)

hi
</pre></p>


	<p>After install:<br /><pre>
[root@localhost ~]# cat /var/spool/mail/root 
[root@localhost ~]# ll /var/lib/nethserver/vmail/admin/Maildir/
cur/                          dovecot.index.log             dovecot-uidvalidity           subscriptions                 
dovecot-acl-list              dovecot.mailbox.log           dovecot-uidvalidity.52d7ad6b  tmp/                          
dovecot.index.cache           dovecot-uidlist               new/                          
[root@localhost ~]# ll /var/lib/nethserver/vmail/admin/Maildir/new/92726a89d24357fe7dd24ae126781790 
-rw-------. 1 vmail vmail 540 Jan 16 10:55 /var/lib/nethserver/vmail/admin/Maildir/new/92726a89d24357fe7dd24ae126781790
[root@localhost ~]# cat /var/lib/nethserver/vmail/admin/Maildir/new/92726a89d24357fe7dd24ae126781790 
Return-Path: &lt;root@localhost.localdomain&gt;
X-Original-To: root
Delivered-To: root@localhost.localdomain
Received: by localhost.localdomain (Postfix, from userid 0)
    id 5386640AC7; Thu, 16 Jan 2014 10:55:46 +0100 (CET)
Date: Thu, 16 Jan 2014 10:55:46 +0100
To: root@localhost.localdomain
Subject: test1
User-Agent: Heirloom mailx 12.4 7/29/08
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-Id: &lt;20140116095546.5386640AC7@localhost.localdomain&gt;
From: root@localhost.localdomain (root)

hi
</pre></p>


Other notes:
	<ul>
	<li>the admin user is automatically enabled to Samba service OK</li>
		<li>domadmins group has "Domain Admins" description OK</li>
		<li>admin/root password change works in both directions OK</li>
	</ul>


	<p>Marking as <strong>VERIFIED</strong></p></div>
    </div>
  </div>
  
  <div id="change-9934" class="journal has-details">
    <div id="note-15">
    <h4><a href="2492.html#note-15" class="journal-link">#15</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Assignee</strong> deleted (<del><i>Giacomo Sanchietti</i></del>)</li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-10404" class="journal has-details">
    <div id="note-16">
    <h4><a href="2492.html#note-16" class="journal-link">#16</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>File</strong> deleted (<del><i>run2492.sh</i></del>)</li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-10405" class="journal has-details">
    <div id="note-17">
    <h4><a href="2492.html#note-17" class="journal-link">#17</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>File</strong> <a href="../attachments/download/246/upgrade-65b3.sh">upgrade-65b3.sh</a><a href="../attachments/246/upgrade-65b3.sh.html"><img alt="Magnifier" src="../images/magnifier.png%3F1403512056" /></a> added</li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-10425" class="journal has-notes has-details">
    <div id="note-18">
    <h4><a href="2492.html#note-18" class="journal-link">#18</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Status</strong> changed from <i>VERIFIED</i> to <i>CLOSED</i></li>
       <li><strong>% Done</strong> changed from <i>90</i> to <i>100</i></li>
    </ul>
    </div>
  </div>
  
  <div id="change-13964" class="journal has-details">
    <div id="note-19">
    <h4><a href="2492.html#note-19" class="journal-link">#19</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />

    </h4><ul class="details">
       <li><strong>Related to</strong> <i><a href="3026.html" class="issue tracker-2 status-5 priority-4 priority-default closed">Feature #3026</a>: Differentiate root and admin users</i> added</li>
    </ul>
    
    </div>
  </div>
  


</div>


<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>





<script type="text/javascript">
//<![CDATA[
contextMenuInit('/issues/context_menu')
//]]>
</script>

        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Copyright &copy; 2012-2021 nethserver.org
  </div></div>
</div>
</div>
</div>

</body>
</html>
